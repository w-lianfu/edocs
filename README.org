#+TITLE: Emacs Docs
#+AUTHOR: wlianfu
#+DATE: 2023-03-17
#+EMAIL: h5lianfu@gmail.com
#+OPTIONS: github address: https://github.com/w-lianfu/edocs
#+OPTIONS: 摘录自 <<学习GNU Emacs (第2版)>>

** 编辑模式(Edit mode)

*** 主模式(major mode)

| 模式                                 | 功能                     |
|--------------------------------------+--------------------------|
| 基本模式(fundamental mode)           | 默认模式，无特殊行为     |
| 文本模式(text mode)                  | 书写文字                 |
| 邮件模式(mail mode)                  | 书写电子邮件             |
| 阅读电子邮件模式(RMAIL mode)         | 阅读和组织电子邮件       |
| 只读模式(view mode)                  | 查看文件，不能编辑       |
| shell 模式(shell mode)               | 运行 shell 命令          |
| FTP 模式(ange-ftp mode)              | 查看远程系统上的文件     |
| Telnet 模式(telnet mode)             | 登录到远程系统           |
| 大纲模式(outline mode)               | 书写大纲                 |
| 缩进文本模式(indented text mode)     | 自动缩进模式             |
| 图形模式(picture mode)               | 绘制图形                 |
| Emacs LISP 模式(Emacs LISP mode)     | 编辑emacs lisp代码       |
| LISP 模式(LISP mode)                 | 编辑lisp代码             |
| LISP 互动模式(LISP interaction mode) | 编辑和运行emacs lisp代码 |

*** 副模式(minor mode)
| 模式                         | 功能                        |
| 自动换行模式(auto-fill mode) | 打开文字自动换行模式        |
| 改写模式(overwrite mode)     | 输入时替换字符              |
| 自动保存模式(auto-save-mode) | 文件按照一定时间自动保存    |
| 行号模式(line number mode)   | 在状态行上显示文本行号      |
| 缩略词模式(abbrev mode)      | 允许使用单词的简写形式      |
| VC 模式(VC mode)             | 在 Emacs 下使用版本控制系统 |

** 文件编辑(Edit file)

*** 与文件操作有关的命令

| 键盘操作 | 命令名称                     | 解释说明       | 实现                                        |
|----------+------------------------------+----------------+---------------------------------------------|
| C-x C-f  | find-file                    | open file      | 查找文件并在一个新缓冲区打开                |
| C-x C-v  | find-alternate-file          | ---            | 读入另一个文件替换掉用 "C-x C-f" 读入的文件 |
| C-x i    | insert-file                  | insert file    | 把文件插入到光标所在位置                    |
| C-x C-s  | save-buffer                  | save-buffer    | 保存文件                                    |
| C-x C-w  | write-file                   | save buffer as | 把缓冲区内容写入一个文件                    |
| C-x C-c  | save-buffers-kill-emacs      | exit emacs     | 退出 Emacs                                  |

*** 帮助相关命令

| 键盘操作         | 命令名称                     | 功能           |                                |
|------------------+------------------------------+----------------+--------------------------------|
| C-h              | help-command                 | help           | 进入 Emacs 的在线帮助系统      |
| C-h C-h 或 C-h ? | help-for-help                | 帮助命令手册   |                                |
| C-h f            | describe-function            | 描述 "命令"    | 描述 "指定命令" 的在线帮助信息 |
| C-h k            | describe-key                 | 描述 "键"      | 描述 "指定键" 的在线帮助信息   |
| C-h t            | help-with-tutorial           | emacs tutorial | 启动 Emacs 教程                |
| C-h i            | info-goto-emacs-command-node | browse manual  | 启动 Info 文档阅读器           |

*** 光标移动命令

| 键盘操作 | 命令名称            | 动作                                           |
|----------+---------------------+------------------------------------------------|
| C-f      | forward-char        | 光标右移一个字符                               |
| C-b      | backward-char       | 光标左移一个字符                               |
| C-p      | previous-line       | 光标上移一行                                   |
| C-n      | next-line           | 光标下移一行                                   |
| M-f      | forward-word        | 光标右移一个单词                               |
| M-b      | backward-word       | 光标左移一个单词                               |
| C-a      | beginning-of-line   | 光标移到行首                                   |
| C-e      | end-of-line         | 光标移到行尾                                   |
| M-e      | forward-sentence    | 光标左移一个句子                               |
| M-a      | backward-sentence   | 光标右移一个句子                               |
| M-}      | forward-paragraph   | 光标右移一个段落                               |
| M-{      | backward-paragraph  | 光标左移一个段落                               |
| C-v      | scroll-up           | 屏幕上卷一屏                                   |
| M-v      | scroll-down         | 屏幕下卷一屏                                   |
| C-x }    | forward-page        | 光标右移一页                                   |
| C-x {    | backward-page       | 光标左移一页                                   |
| M-<      | beginning-of-buffer | 光标左移到文件头                               |
| M->      | end-of-buffer       | 光标右移到文件尾                               |
| 无       | goto-line           | 光标前进到文件的第 [n] 行                      |
| 无       | goto-char           | 光标前进到文件的第 [n] 个字符                  |
| C-l      | recenter            | 重新绘制画面，并将当前行放到画面中心处         |
| M [n]    | digit-argument      | 重复执行 [n] 次后续命令                        |
| C-u [n]  | universal-argument  | 重复执行 [n] 次后续命令(省略 [n] 时 重复 4 次) |

*** 文本删除命令

| 键盘操作 | 命令名称                | 动作                   |
|----------+-------------------------+------------------------|
| C-d      | delete-char             | 删除光标所在位置的字符 |
| DEL      | delete-backward-char    | 删除光标左侧的字符     |
| M-d      | kill-word               | 删除光标右侧的单词     |
| M-DEL    | backward-kill-word      | 删除光标左侧的单词     |
| C-k      | kill-line               | 从光标位置删除到行尾   |
| M-k      | kill-sentence           | 删除光标右侧的句子     |
| C-x DEL  | backward-kill-sentence  | 删除光标左侧的句子     |
| C-y      | yank                    | 恢复被删除的文本       |
| C-w      | kill-region             | 删除文本块             |
| 无       | kill-paragraph          | 删除光标右侧的段落     |
| 无       | backward-kill-paragraph | 删除光标左侧的段落     |

*** 文本块操作命令

| 键盘操作       | 命令名称                | 动作                                  |
|----------------+-------------------------+---------------------------------------|
| C-@ 或 C-SPACE | set-mark-command        | 标记文本块的开始(或结束)位置          |
| C-x C-x        | exchange-point-and-mark | 互换插入点和文本标记的位置            |
| C-w            | kill-region             | 删除文本块                            |
| C-y            | yank                    | 粘贴最近删除或复制的文本              |
| M-w            | kill-ring-save          | 复制文本块                            |
| M-h            | mark-paragraph          | 标记段落                              |
| C-x C-p        | mark-page               | 标记页面                              |
| C-x h          | mark-whole-buffer       | 标记整个缓冲区                        |
| M-y            | yank-pop                | 在用过 "C-y" 命令后粘贴更早删除的文本 |

*** 位置交换命令

| 键盘操作 | 命令名称             | 动作                 |
|----------+----------------------+----------------------|
| C-t      | transpose-chars      | 交换两个字符的位置   |
| M-t      | transpose-words      | 交换两个单词的位置   |
| C-x C-t  | transpose-lines      | 交换两个文本行的位置 |
| 无       | transpose-sentences  | 交换两个句子的位置   |
| 无       | transpose-paragraphs | 交换两个段落的位置   |

*** 字母大小写编辑命令

| 键盘操作 | 命令名称                          | 动作                           |
|----------+-----------------------------------+--------------------------------|
| M-c      | capitalize-word                   | 把单词的首字符改为大写         |
| M-u      | upcase-word                       | 把单词的字符全部改为大写       |
| M-l      | downcase-word                     | 把单词的字符全部改为小写       |
| M - M-c  | negtive-argument; capitalize-word | 把前一个单词的首字符改为大写   |
| M - M-u  | negtive-argument; upcase-word     | 把前一个单词的字符全部改为大写 |
| M - M-l  | negtive-argument; downcase-word   | 把前一个单词的字符全部改为小写 |

*** 命令的中止和撤销

| 键盘操作   | 命令名称        | 动作                           |
|------------+-----------------+--------------------------------|
| C-g        | keyboard-quit   | 放弃当前命令                   |
| C-x u      | advertised-undo | 撤销上一次编辑                 |
| C-_ 或 C-/ | undo            | 撤销上一次编辑                 |
| 无         | revert-buffer   | 把缓冲区恢复到上次文件存盘状态 |

** GNU Emacs Reference Card

#+ATTR_HTML: :width 100%
[[./photo/GNU Emacs Reference Card.png]]

#+ATTR_HTML: :width 100%
[[./photo/GNU Emacs Reference Card-version22.png]]

*** Dired 操作命令

| 键盘操作 | 解释说明                | 命令名称                     | 动作                                                       |
|----------+-------------------------+------------------------------+------------------------------------------------------------|
| C-x d    | Open Directory          | dired                        | 启动 Dired                                                 |
| C        | Copy to                 | dired-do-copy                | 复制文件                                                   |
| d        | Flag                    | dired-flag-file-deletion     | 给文件加上删除标记                                         |
| D        | Delete                  | dired-do-delete              | 删除文件                                                   |
| e        | Find This File          | dired-find-file              | 编辑文件                                                   |
| f        |                         | dired-advertised-find-file   | 查找文件(并进行编辑)                                       |
| g        | Revert Buffer           | revert-buffer                | 从磁盘上重新读入目录                                       |
| G        | Chang Group             | dired-do-chgrp               | 改变文件的组权限                                           |
| k        |                         | dired-do-kill-lines          | 从画面上删除光标所在的那一行                               |
| m        | Mark                    | dired-mark                   | 给文件加上 * 待操作标记                                    |
| n        |                         | dired-next-line              | 移动到下一行                                               |
| o        | Find in Other Window    | dired-find-file-other-window | 在另一个窗口里查找文件，并移动到新窗口                     |
| C-o      | Display in Other Window | dired-display-file           | 在另一个窗口里查找文件，不移动到新窗口                     |
| q        |                         | dired-quit                   | 退出 Dired                                                 |
| Q        |                         | dired-do-query-replace       | 在有待操作标记的文件里对字符串进行查找-替换操作            |
| R        | Rename to               | dired-do-rename              | 重新命名文件                                               |
| u        | Unmark                  | dired-unmark                 | 去掉待操作标记                                             |
| v        | View This File          | dired-view-file              | 查看文件内容                                               |
| x        |                         | dired-do-flagged-delete      | 删除有待删除标记"D"的文件                                  |
| Z        | Compress                | dired-do-compress            | 对文件进行压缩或解压缩操作                                 |
| 无       | Unmark All              | dired-unmark-all-files       | 把文件上待操作标记移除                                     |
| ~        | Flag Backup Files       | dired-flag-backup-files      | 给备份文件加上待删除标记(去掉这些标记的命令是 "C-u ~")     |
| *        | Mark Executables        | dired-mark-executables       | 给可执行文件加上 * 标记(去掉这些标记的命令是 "C-u *")      |
| #        | Flag auto-save Files    | dired-flag-auto-save-files   | 给自动保存文件加上待删除标记(去掉这些标记的命令是 "C-u #") |
| `        | Mark Old Backups        | dired-clean-directory        | 给带编号的备份文件加上待删除标记                           |
| /        | Mark Directories        | dired-mark-directories       | 给目录加上 * 标记(去掉这些标记的命令是 "C-u /")            |
| =        | Diff                    | dired-diff                   | 把当前文件与(文本标记处的)另一个文件进行比较               |
| 无       | Compare With Backup     | dired-backup-diff            | 把当前文件与它的备份文件进行比较                           |
| !        | Shell command           | dired-do-shell-command       | 执行shell命令(命令的操作对象是有待操作标记的文件)          |
| 无       | Next Marked             | dired-next-marked-file       | 移动到有 * 或 D 标记的下一个文件                           |
| 无       | Previous Marked         | dired-prev-marked-file       | 移动到有 * 或 D 标记的上一个文件                           |
| %d       | Regexp Flag             | dired-flag-files-regexp      | 给匹配此正则表达式的文件加上待删除标记                     |
| %m       | Regexp Flag             | dired-mark-files-regexp      | 给匹配此正则表达式的文件加上待操作标记                     |
| +        | Create Directory        | dired-create-directory       | 创建一个目录                                               |
| >        | Next Dirline            | dired-next-dirline           | 移动到下一个目录                                           |
| <        | Prev Dirline            | dired-prev-dirline           | 移动到上一个目录                                           |
| s        |                         | dired-sort-toggle-or-edit    | 对Dired编辑缓冲区里的文件清单按日期或文件名重新排序        |


** 对 Emacs 进行定制

*** Tips

+ 通过emacs -q 启动emacs不会读取.emacs文件配置

*** Emacs 配置

**** use-package

+ 常用格式
#+BEGIN_SRC emacs
(use-package package-name
             :ensure t ; 是否一定要确保已安装
             :defer t ; 是否要延迟加载
             :init (setq ...) ; 初始化配置
             :config (...) ; 初始化后的基本配置参数
             :bind (...) ; 快捷键绑定
             :hook (...) ; hook的绑定)
#+END_SRC

+ 建议添加的配置
#+BEGIN_SRC emacs
;; `use-package-always-ensure` 避免每个软件包都加 ":ensure t"
;; `use-package-always-defer` 避免每个软件包都加 ":defer t"

(setq use-package-always-ensure t
      use-package-always-defer t
      use-package-enable-imenu-support t
      use-package-expand-minimally t)
#+END_SRC

+ 操作系统判断
#+BEGIN_SRC emacs
(defconst *is-mac* (eq system-type 'darwin))
(defconst *is-linux* (eq system-type 'gnu/linux))
(defconst *is-windows* (or (eq system-type 'ms-dos) (eq system-type 'windows-nt)))
#+END_SRC

+ 用 y/n 代替 yes/no
#+BEGIN_SRC emacs
(defalias 'yes-or-no-p 'y-or-n-p)
#+END_SRC

*** Emacs 阅读推荐

+ [[https://www.cnblogs.com/youge/p/4518739.html][Emacs 快速指南]]
+ [[https://www.cnblogs.com/Open_Source/archive/2011/07/17/2108747.html#sec-4-1][Org-mode 简明手册]]
+ [[https://juejin.cn/post/7085254713595133960#heading-21][Emacs 高手修炼手册]]

